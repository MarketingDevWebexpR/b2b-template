{"version":3,"sources":["../../src/utils/index.ts","../../src/utils/useStorage.ts"],"sourcesContent":["/**\n * Utility Hooks\n *\n * Platform-agnostic utility hooks.\n */\n\nexport {\n  useStorage,\n  useSessionStorage,\n  setStorageAdapter,\n  type StorageAdapter,\n  type UseStorageOptions,\n  type UseStorageResult,\n} from \"./useStorage\";\n","/**\n * Storage Hook\n *\n * Platform-agnostic storage abstraction for web and mobile.\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\n\n/**\n * Storage adapter interface\n */\nexport interface StorageAdapter {\n  /** Get item from storage */\n  getItem: (key: string) => Promise<string | null> | string | null;\n  /** Set item in storage */\n  setItem: (key: string, value: string) => Promise<void> | void;\n  /** Remove item from storage */\n  removeItem: (key: string) => Promise<void> | void;\n}\n\n/**\n * Default web storage adapter\n */\nconst webStorageAdapter: StorageAdapter = {\n  getItem: (key) => {\n    if (typeof window === \"undefined\") return null;\n    return localStorage.getItem(key);\n  },\n  setItem: (key, value) => {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(key, value);\n    }\n  },\n  removeItem: (key) => {\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(key);\n    }\n  },\n};\n\n/**\n * Global storage adapter - can be overridden for React Native\n */\nlet globalStorageAdapter: StorageAdapter = webStorageAdapter;\n\n/**\n * Set the global storage adapter\n *\n * @param adapter - Storage adapter to use\n *\n * @example\n * ```typescript\n * // In React Native app initialization\n * import AsyncStorage from '@react-native-async-storage/async-storage';\n *\n * setStorageAdapter({\n *   getItem: AsyncStorage.getItem,\n *   setItem: AsyncStorage.setItem,\n *   removeItem: AsyncStorage.removeItem,\n * });\n * ```\n */\nexport function setStorageAdapter(adapter: StorageAdapter): void {\n  globalStorageAdapter = adapter;\n}\n\n/**\n * Storage hook options\n */\nexport interface UseStorageOptions<T> {\n  /** Serializer function (default: JSON.stringify) */\n  serialize?: (value: T) => string;\n  /** Deserializer function (default: JSON.parse) */\n  deserialize?: (value: string) => T;\n  /** Custom storage adapter */\n  storage?: StorageAdapter;\n}\n\n/**\n * Storage hook result\n */\nexport interface UseStorageResult<T> {\n  /** Current value */\n  value: T;\n  /** Set value */\n  setValue: (value: T | ((prev: T) => T)) => void;\n  /** Remove value from storage */\n  remove: () => void;\n  /** Loading state (for async storage) */\n  isLoading: boolean;\n  /** Error if any */\n  error: Error | null;\n}\n\n/**\n * Hook for persisted storage (localStorage/AsyncStorage)\n *\n * @param key - Storage key\n * @param defaultValue - Default value if not found\n * @param options - Hook options\n * @returns Storage state and actions\n *\n * @example\n * ```typescript\n * // Simple usage\n * const { value, setValue } = useStorage('user-preferences', { theme: 'light' });\n *\n * // Update value\n * setValue({ theme: 'dark' });\n *\n * // Update with callback\n * setValue(prev => ({ ...prev, theme: 'dark' }));\n * ```\n */\nexport function useStorage<T>(\n  key: string,\n  defaultValue: T,\n  options: UseStorageOptions<T> = {}\n): UseStorageResult<T> {\n  const {\n    serialize = JSON.stringify,\n    deserialize = JSON.parse,\n    storage = globalStorageAdapter,\n  } = options;\n\n  const [value, setValueState] = useState<T>(defaultValue);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Load initial value\n  useEffect(() => {\n    const loadValue = async () => {\n      try {\n        setIsLoading(true);\n        const stored = await storage.getItem(key);\n        if (stored !== null) {\n          setValueState(deserialize(stored));\n        }\n        setError(null);\n      } catch (err) {\n        setError(err instanceof Error ? err : new Error(String(err)));\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadValue();\n  }, [key, storage, deserialize]);\n\n  // Set value\n  const setValue = useCallback(\n    (newValue: T | ((prev: T) => T)) => {\n      setValueState((prev) => {\n        const resolvedValue =\n          typeof newValue === \"function\"\n            ? (newValue as (prev: T) => T)(prev)\n            : newValue;\n\n        // Save to storage\n        try {\n          storage.setItem(key, serialize(resolvedValue));\n          setError(null);\n        } catch (err) {\n          setError(err instanceof Error ? err : new Error(String(err)));\n        }\n\n        return resolvedValue;\n      });\n    },\n    [key, storage, serialize]\n  );\n\n  // Remove value\n  const remove = useCallback(() => {\n    try {\n      storage.removeItem(key);\n      setValueState(defaultValue);\n      setError(null);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error(String(err)));\n    }\n  }, [key, storage, defaultValue]);\n\n  return {\n    value,\n    setValue,\n    remove,\n    isLoading,\n    error,\n  };\n}\n\n/**\n * Module-level in-memory storage for SSR/mobile fallback.\n * This persists across component renders but clears on page refresh,\n * mimicking session storage behavior.\n */\nconst sessionMemoryStorage = new Map<string, string>();\n\n/**\n * Session storage adapter with SSR-safe fallback\n */\nconst sessionStorageAdapter: StorageAdapter = {\n  getItem: (k) => {\n    if (typeof window !== \"undefined\" && window.sessionStorage) {\n      return sessionStorage.getItem(k);\n    }\n    return sessionMemoryStorage.get(k) ?? null;\n  },\n  setItem: (k, v) => {\n    if (typeof window !== \"undefined\" && window.sessionStorage) {\n      sessionStorage.setItem(k, v);\n    } else {\n      sessionMemoryStorage.set(k, v);\n    }\n  },\n  removeItem: (k) => {\n    if (typeof window !== \"undefined\" && window.sessionStorage) {\n      sessionStorage.removeItem(k);\n    } else {\n      sessionMemoryStorage.delete(k);\n    }\n  },\n};\n\n/**\n * Hook for session storage (web only, memory fallback on mobile)\n */\nexport function useSessionStorage<T>(\n  key: string,\n  defaultValue: T,\n  options: UseStorageOptions<T> = {}\n): UseStorageResult<T> {\n  return useStorage(key, defaultValue, {\n    ...options,\n    storage: sessionStorageAdapter,\n  });\n}\n"],"mappings":"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","names":[]}