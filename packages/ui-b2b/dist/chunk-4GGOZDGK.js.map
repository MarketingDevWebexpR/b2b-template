{"version":3,"sources":["../src/primitives/DataTable/useDataTable.ts","../src/primitives/BulkSelector/useBulkSelector.ts","../src/primitives/ApprovalFlow/useApprovalFlow.ts","../src/primitives/SpendingMeter/types.ts","../src/primitives/SpendingMeter/useSpendingMeter.ts","../src/primitives/QuoteBuilder/useQuoteBuilder.ts"],"sourcesContent":["import { useCallback, useMemo, useReducer } from \"react\";\nimport type {\n  ColumnDef,\n  DataTableState,\n  FilterConfig,\n  PaginationConfig,\n  PaginationState,\n  RowSelectionState,\n  SortConfig,\n  SortDirection,\n  UseDataTableOptions,\n  UseDataTableReturn,\n} from \"./types\";\n\n/**\n * Action types for the data table reducer\n */\ntype DataTableAction<TData> =\n  | { type: \"SET_SORT\"; payload: SortConfig<TData> | null }\n  | { type: \"SET_FILTER\"; payload: FilterConfig<TData> }\n  | { type: \"REMOVE_FILTER\"; payload: keyof TData | string }\n  | { type: \"CLEAR_FILTERS\" }\n  | { type: \"SET_FILTERS\"; payload: FilterConfig<TData>[] }\n  | { type: \"SET_PAGE\"; payload: number }\n  | { type: \"SET_PAGE_SIZE\"; payload: number }\n  | { type: \"SELECT_ROW\"; payload: string }\n  | { type: \"DESELECT_ROW\"; payload: string }\n  | { type: \"TOGGLE_ROW\"; payload: string }\n  | { type: \"SELECT_ALL\"; payload: string[] }\n  | { type: \"DESELECT_ALL\" }\n  | { type: \"SET_COLUMN_VISIBILITY\"; payload: { columnId: string; visible: boolean } }\n  | { type: \"SET_DATA\"; payload: TData[] }\n  | { type: \"RESET\"; payload: InternalState<TData> };\n\n/**\n * Internal state (without computed values)\n */\ninterface InternalState<TData> {\n  originalData: TData[];\n  columns: ColumnDef<TData>[];\n  sort: SortConfig<TData> | null;\n  filters: FilterConfig<TData>[];\n  pageIndex: number;\n  pageSize: number;\n  selectedRowIds: Set<string>;\n}\n\n/**\n * Create initial state\n */\nfunction createInitialState<TData>(\n  options: UseDataTableOptions<TData>\n): InternalState<TData> {\n  return {\n    originalData: options.data,\n    columns: options.columns.map((col) => ({\n      ...col,\n      visible: col.visible !== false,\n    })),\n    sort: options.initialSort ?? null,\n    filters: options.initialFilters ?? [],\n    pageIndex: 0,\n    pageSize: options.pageSize ?? 10,\n    selectedRowIds: new Set(options.initialSelection ?? []),\n  };\n}\n\n/**\n * Reducer for data table state\n */\nfunction dataTableReducer<TData>(\n  state: InternalState<TData>,\n  action: DataTableAction<TData>\n): InternalState<TData> {\n  switch (action.type) {\n    case \"SET_SORT\":\n      return { ...state, sort: action.payload, pageIndex: 0 };\n\n    case \"SET_FILTER\": {\n      const existingIndex = state.filters.findIndex(\n        (f) => f.key === action.payload.key\n      );\n      const newFilters =\n        existingIndex >= 0\n          ? state.filters.map((f, i) => (i === existingIndex ? action.payload : f))\n          : [...state.filters, action.payload];\n      return { ...state, filters: newFilters, pageIndex: 0 };\n    }\n\n    case \"REMOVE_FILTER\":\n      return {\n        ...state,\n        filters: state.filters.filter((f) => f.key !== action.payload),\n        pageIndex: 0,\n      };\n\n    case \"CLEAR_FILTERS\":\n      return { ...state, filters: [], pageIndex: 0 };\n\n    case \"SET_FILTERS\":\n      return { ...state, filters: action.payload, pageIndex: 0 };\n\n    case \"SET_PAGE\":\n      return { ...state, pageIndex: action.payload };\n\n    case \"SET_PAGE_SIZE\":\n      return { ...state, pageSize: action.payload, pageIndex: 0 };\n\n    case \"SELECT_ROW\": {\n      const newSelected = new Set(state.selectedRowIds);\n      newSelected.add(action.payload);\n      return { ...state, selectedRowIds: newSelected };\n    }\n\n    case \"DESELECT_ROW\": {\n      const newSelected = new Set(state.selectedRowIds);\n      newSelected.delete(action.payload);\n      return { ...state, selectedRowIds: newSelected };\n    }\n\n    case \"TOGGLE_ROW\": {\n      const newSelected = new Set(state.selectedRowIds);\n      if (newSelected.has(action.payload)) {\n        newSelected.delete(action.payload);\n      } else {\n        newSelected.add(action.payload);\n      }\n      return { ...state, selectedRowIds: newSelected };\n    }\n\n    case \"SELECT_ALL\":\n      return { ...state, selectedRowIds: new Set(action.payload) };\n\n    case \"DESELECT_ALL\":\n      return { ...state, selectedRowIds: new Set() };\n\n    case \"SET_COLUMN_VISIBILITY\":\n      return {\n        ...state,\n        columns: state.columns.map((col) =>\n          col.id === action.payload.columnId\n            ? { ...col, visible: action.payload.visible }\n            : col\n        ),\n      };\n\n    case \"SET_DATA\":\n      return { ...state, originalData: action.payload };\n\n    case \"RESET\":\n      return action.payload;\n\n    default:\n      return state;\n  }\n}\n\n/**\n * Get nested value from object using dot notation path\n */\nfunction getNestedValue<TData>(obj: TData, path: string): unknown {\n  return path.split(\".\").reduce<unknown>((current, key) => {\n    if (current && typeof current === \"object\" && key in current) {\n      return (current as Record<string, unknown>)[key];\n    }\n    return undefined;\n  }, obj);\n}\n\n/**\n * Default sort function\n */\nfunction defaultSortFn<TData>(\n  a: TData,\n  b: TData,\n  key: string,\n  direction: SortDirection\n): number {\n  if (direction === null) return 0;\n\n  const aVal = getNestedValue(a, key);\n  const bVal = getNestedValue(b, key);\n\n  // Handle null/undefined\n  if (aVal == null && bVal == null) return 0;\n  if (aVal == null) return direction === \"asc\" ? 1 : -1;\n  if (bVal == null) return direction === \"asc\" ? -1 : 1;\n\n  // Compare values\n  let comparison = 0;\n  if (typeof aVal === \"string\" && typeof bVal === \"string\") {\n    comparison = aVal.localeCompare(bVal);\n  } else if (typeof aVal === \"number\" && typeof bVal === \"number\") {\n    comparison = aVal - bVal;\n  } else if (aVal instanceof Date && bVal instanceof Date) {\n    comparison = aVal.getTime() - bVal.getTime();\n  } else {\n    comparison = String(aVal).localeCompare(String(bVal));\n  }\n\n  return direction === \"asc\" ? comparison : -comparison;\n}\n\n/**\n * Default filter function\n */\nfunction defaultFilterFn<TData>(row: TData, filter: FilterConfig<TData>): boolean {\n  const value = getNestedValue(row, filter.key as string);\n\n  switch (filter.operator) {\n    case \"equals\":\n      return value === filter.value;\n\n    case \"notEquals\":\n      return value !== filter.value;\n\n    case \"contains\":\n      return String(value).toLowerCase().includes(String(filter.value).toLowerCase());\n\n    case \"notContains\":\n      return !String(value).toLowerCase().includes(String(filter.value).toLowerCase());\n\n    case \"startsWith\":\n      return String(value).toLowerCase().startsWith(String(filter.value).toLowerCase());\n\n    case \"endsWith\":\n      return String(value).toLowerCase().endsWith(String(filter.value).toLowerCase());\n\n    case \"gt\":\n      return Number(value) > Number(filter.value);\n\n    case \"gte\":\n      return Number(value) >= Number(filter.value);\n\n    case \"lt\":\n      return Number(value) < Number(filter.value);\n\n    case \"lte\":\n      return Number(value) <= Number(filter.value);\n\n    case \"between\":\n      return (\n        Number(value) >= Number(filter.value) &&\n        Number(value) <= Number(filter.valueTo)\n      );\n\n    case \"in\":\n      return Array.isArray(filter.value) && filter.value.includes(value);\n\n    case \"notIn\":\n      return Array.isArray(filter.value) && !filter.value.includes(value);\n\n    case \"isEmpty\":\n      return value == null || value === \"\";\n\n    case \"isNotEmpty\":\n      return value != null && value !== \"\";\n\n    default:\n      return true;\n  }\n}\n\n/**\n * Hook for headless data table state management\n *\n * Provides sorting, filtering, pagination, and row selection\n * functionality without any UI rendering.\n *\n * @example\n * ```tsx\n * const table = useDataTable({\n *   data: products,\n *   columns: [\n *     { id: 'name', accessorKey: 'name', header: 'Name', sortable: true },\n *     { id: 'price', accessorKey: 'price', header: 'Price', sortable: true },\n *   ],\n *   getRowId: (row) => row.id,\n *   pageSize: 20,\n *   selectionMode: 'multiple',\n * });\n *\n * // Use table.state.data for current page data\n * // Use table.toggleSort('name') to sort by name\n * // Use table.nextPage() to go to next page\n * ```\n */\nexport function useDataTable<TData>(\n  options: UseDataTableOptions<TData>\n): UseDataTableReturn<TData> {\n  const {\n    data,\n    columns,\n    getRowId,\n    pageSize = 10,\n    selectionMode = \"none\",\n    enableClientSideSort = true,\n    enableClientSideFilter = true,\n    enableClientSidePagination = true,\n    serverSideTotalCount,\n    onSortChange,\n    onFiltersChange,\n    onPaginationChange,\n    onSelectionChange,\n  } = options;\n\n  const initialState = useMemo(\n    () => createInitialState(options),\n    // Only recreate on column changes, not data changes\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [columns]\n  );\n\n  const [state, dispatch] = useReducer(dataTableReducer<TData>, initialState);\n\n  // Update data when it changes externally\n  useMemo(() => {\n    if (data !== state.originalData) {\n      dispatch({ type: \"SET_DATA\", payload: data });\n    }\n  }, [data, state.originalData]);\n\n  // Process data (filter and sort)\n  const processedData = useMemo(() => {\n    let result = [...(data || [])];\n\n    // Apply filters (client-side)\n    if (enableClientSideFilter && state.filters.length > 0) {\n      result = result.filter((row) => {\n        return state.filters.every((filter) => {\n          const column = state.columns.find(\n            (c) => c.id === filter.key || c.accessorKey === filter.key\n          );\n          if (column?.filterFn) {\n            return column.filterFn(row, filter);\n          }\n          return defaultFilterFn(row, filter);\n        });\n      });\n    }\n\n    // Apply sort (client-side)\n    if (enableClientSideSort && state.sort && state.sort.direction) {\n      const column = state.columns.find(\n        (c) => c.id === state.sort!.key || c.accessorKey === state.sort!.key\n      );\n      const sortKey = (column?.accessorKey as string) || (state.sort.key as string);\n\n      result.sort((a, b) => {\n        if (column?.sortFn) {\n          return column.sortFn(a, b, state.sort!.direction);\n        }\n        return defaultSortFn(a, b, sortKey, state.sort!.direction);\n      });\n    }\n\n    return result;\n  }, [\n    data,\n    state.filters,\n    state.sort,\n    state.columns,\n    enableClientSideFilter,\n    enableClientSideSort,\n  ]);\n\n  // Calculate pagination\n  const paginationState: PaginationState = useMemo(() => {\n    const totalItems = serverSideTotalCount ?? processedData.length;\n    const totalPages = Math.max(1, Math.ceil(totalItems / state.pageSize));\n    const safePageIndex = Math.min(state.pageIndex, totalPages - 1);\n    const startIndex = safePageIndex * state.pageSize + 1;\n    const endIndex = Math.min(startIndex + state.pageSize - 1, totalItems);\n\n    return {\n      pageIndex: safePageIndex,\n      pageSize: state.pageSize,\n      totalItems,\n      totalPages,\n      hasPreviousPage: safePageIndex > 0,\n      hasNextPage: safePageIndex < totalPages - 1,\n      startIndex: totalItems > 0 ? startIndex : 0,\n      endIndex,\n    };\n  }, [processedData.length, state.pageIndex, state.pageSize, serverSideTotalCount]);\n\n  // Get paginated data\n  const paginatedData = useMemo(() => {\n    if (!enableClientSidePagination) {\n      return processedData;\n    }\n    const start = paginationState.pageIndex * paginationState.pageSize;\n    const end = start + paginationState.pageSize;\n    return processedData.slice(start, end);\n  }, [processedData, paginationState, enableClientSidePagination]);\n\n  // Calculate row selection state\n  const rowSelectionState: RowSelectionState = useMemo(() => {\n    const visibleRowIds = paginatedData.map(getRowId);\n    const selectedVisibleCount = visibleRowIds.filter((id) =>\n      state.selectedRowIds.has(id)\n    ).length;\n\n    return {\n      selectedRowIds: state.selectedRowIds,\n      allSelected: visibleRowIds.length > 0 && selectedVisibleCount === visibleRowIds.length,\n      someSelected: selectedVisibleCount > 0 && selectedVisibleCount < visibleRowIds.length,\n    };\n  }, [paginatedData, state.selectedRowIds, getRowId]);\n\n  // Build full state\n  const fullState: DataTableState<TData> = useMemo(\n    () => ({\n      data: paginatedData,\n      originalData: data,\n      columns: state.columns,\n      sort: state.sort,\n      filters: state.filters,\n      pagination: paginationState,\n      rowSelection: rowSelectionState,\n      isLoading: false,\n      error: null,\n    }),\n    [\n      paginatedData,\n      data,\n      state.columns,\n      state.sort,\n      state.filters,\n      paginationState,\n      rowSelectionState,\n    ]\n  );\n\n  // Sorting actions\n  const setSort = useCallback(\n    (sort: SortConfig<TData> | null) => {\n      dispatch({ type: \"SET_SORT\", payload: sort });\n      onSortChange?.(sort);\n    },\n    [onSortChange]\n  );\n\n  const toggleSort = useCallback(\n    (columnId: string) => {\n      const column = state.columns.find((c) => c.id === columnId);\n      if (!column?.sortable) return;\n\n      const key = (column.accessorKey as string) || columnId;\n      let newDirection: SortDirection = \"asc\";\n\n      if (state.sort?.key === key) {\n        if (state.sort.direction === \"asc\") {\n          newDirection = \"desc\";\n        } else if (state.sort.direction === \"desc\") {\n          newDirection = null;\n        }\n      }\n\n      const newSort = newDirection ? { key, direction: newDirection } : null;\n      dispatch({ type: \"SET_SORT\", payload: newSort });\n      onSortChange?.(newSort);\n    },\n    [state.columns, state.sort, onSortChange]\n  );\n\n  const clearSort = useCallback(() => {\n    dispatch({ type: \"SET_SORT\", payload: null });\n    onSortChange?.(null);\n  }, [onSortChange]);\n\n  // Filter actions\n  const setFilter = useCallback(\n    (filter: FilterConfig<TData>) => {\n      dispatch({ type: \"SET_FILTER\", payload: filter });\n      const newFilters = state.filters.some((f) => f.key === filter.key)\n        ? state.filters.map((f) => (f.key === filter.key ? filter : f))\n        : [...state.filters, filter];\n      onFiltersChange?.(newFilters);\n    },\n    [state.filters, onFiltersChange]\n  );\n\n  const removeFilter = useCallback(\n    (columnKey: keyof TData | string) => {\n      dispatch({ type: \"REMOVE_FILTER\", payload: columnKey });\n      onFiltersChange?.(state.filters.filter((f) => f.key !== columnKey));\n    },\n    [state.filters, onFiltersChange]\n  );\n\n  const clearFilters = useCallback(() => {\n    dispatch({ type: \"CLEAR_FILTERS\" });\n    onFiltersChange?.([]);\n  }, [onFiltersChange]);\n\n  const setFilters = useCallback(\n    (filters: FilterConfig<TData>[]) => {\n      dispatch({ type: \"SET_FILTERS\", payload: filters });\n      onFiltersChange?.(filters);\n    },\n    [onFiltersChange]\n  );\n\n  // Pagination actions\n  const goToPage = useCallback(\n    (pageIndex: number) => {\n      const safePage = Math.max(0, Math.min(pageIndex, paginationState.totalPages - 1));\n      dispatch({ type: \"SET_PAGE\", payload: safePage });\n      onPaginationChange?.({ pageIndex: safePage, pageSize: state.pageSize });\n    },\n    [paginationState.totalPages, state.pageSize, onPaginationChange]\n  );\n\n  const nextPage = useCallback(() => {\n    if (paginationState.hasNextPage) {\n      goToPage(paginationState.pageIndex + 1);\n    }\n  }, [paginationState, goToPage]);\n\n  const previousPage = useCallback(() => {\n    if (paginationState.hasPreviousPage) {\n      goToPage(paginationState.pageIndex - 1);\n    }\n  }, [paginationState, goToPage]);\n\n  const firstPage = useCallback(() => {\n    goToPage(0);\n  }, [goToPage]);\n\n  const lastPage = useCallback(() => {\n    goToPage(paginationState.totalPages - 1);\n  }, [paginationState.totalPages, goToPage]);\n\n  const setPageSize = useCallback(\n    (size: number) => {\n      dispatch({ type: \"SET_PAGE_SIZE\", payload: size });\n      onPaginationChange?.({ pageIndex: 0, pageSize: size });\n    },\n    [onPaginationChange]\n  );\n\n  // Row selection actions\n  const selectRow = useCallback(\n    (rowId: string) => {\n      if (selectionMode === \"none\") return;\n\n      if (selectionMode === \"single\") {\n        dispatch({ type: \"DESELECT_ALL\" });\n      }\n      dispatch({ type: \"SELECT_ROW\", payload: rowId });\n\n      const newSelected = new Set(state.selectedRowIds);\n      if (selectionMode === \"single\") {\n        newSelected.clear();\n      }\n      newSelected.add(rowId);\n      onSelectionChange?.(Array.from(newSelected));\n    },\n    [selectionMode, state.selectedRowIds, onSelectionChange]\n  );\n\n  const deselectRow = useCallback(\n    (rowId: string) => {\n      dispatch({ type: \"DESELECT_ROW\", payload: rowId });\n      const newSelected = new Set(state.selectedRowIds);\n      newSelected.delete(rowId);\n      onSelectionChange?.(Array.from(newSelected));\n    },\n    [state.selectedRowIds, onSelectionChange]\n  );\n\n  const toggleRowSelection = useCallback(\n    (rowId: string) => {\n      if (selectionMode === \"none\") return;\n\n      if (state.selectedRowIds.has(rowId)) {\n        deselectRow(rowId);\n      } else {\n        selectRow(rowId);\n      }\n    },\n    [selectionMode, state.selectedRowIds, selectRow, deselectRow]\n  );\n\n  const selectAll = useCallback(() => {\n    if (selectionMode !== \"multiple\") return;\n\n    const allIds = paginatedData.map(getRowId);\n    dispatch({ type: \"SELECT_ALL\", payload: allIds });\n    onSelectionChange?.(allIds);\n  }, [selectionMode, paginatedData, getRowId, onSelectionChange]);\n\n  const deselectAll = useCallback(() => {\n    dispatch({ type: \"DESELECT_ALL\" });\n    onSelectionChange?.([]);\n  }, [onSelectionChange]);\n\n  const toggleSelectAll = useCallback(() => {\n    if (rowSelectionState.allSelected) {\n      deselectAll();\n    } else {\n      selectAll();\n    }\n  }, [rowSelectionState.allSelected, selectAll, deselectAll]);\n\n  const isRowSelected = useCallback(\n    (rowId: string) => state.selectedRowIds.has(rowId),\n    [state.selectedRowIds]\n  );\n\n  const getSelectedRows = useCallback((): TData[] => {\n    return data.filter((row) => state.selectedRowIds.has(getRowId(row)));\n  }, [data, state.selectedRowIds, getRowId]);\n\n  // Column visibility\n  const toggleColumnVisibility = useCallback((columnId: string) => {\n    const column = state.columns.find((c) => c.id === columnId);\n    if (column) {\n      dispatch({\n        type: \"SET_COLUMN_VISIBILITY\",\n        payload: { columnId, visible: !column.visible },\n      });\n    }\n  }, [state.columns]);\n\n  const setColumnVisibility = useCallback((columnId: string, visible: boolean) => {\n    dispatch({ type: \"SET_COLUMN_VISIBILITY\", payload: { columnId, visible } });\n  }, []);\n\n  const getVisibleColumns = useCallback(\n    () => state.columns.filter((c) => c.visible !== false),\n    [state.columns]\n  );\n\n  // Data access\n  const getPaginatedData = useCallback(() => paginatedData, [paginatedData]);\n\n  const getProcessedData = useCallback(() => processedData, [processedData]);\n\n  const getCellValue = useCallback(\n    <TValue = unknown>(row: TData, columnId: string): TValue => {\n      const column = state.columns.find((c) => c.id === columnId);\n      if (!column) {\n        return undefined as TValue;\n      }\n\n      if (column.accessorFn) {\n        return column.accessorFn(row) as TValue;\n      }\n\n      if (column.accessorKey) {\n        return getNestedValue(row, column.accessorKey as string) as TValue;\n      }\n\n      return undefined as TValue;\n    },\n    [state.columns]\n  );\n\n  // Reset\n  const reset = useCallback(() => {\n    dispatch({ type: \"RESET\", payload: initialState });\n  }, [initialState]);\n\n  return {\n    state: fullState,\n\n    // Sorting\n    setSort,\n    toggleSort,\n    clearSort,\n\n    // Filtering\n    setFilter,\n    removeFilter,\n    clearFilters,\n    setFilters,\n\n    // Pagination\n    goToPage,\n    nextPage,\n    previousPage,\n    firstPage,\n    lastPage,\n    setPageSize,\n\n    // Row selection\n    selectRow,\n    deselectRow,\n    toggleRowSelection,\n    selectAll,\n    deselectAll,\n    toggleSelectAll,\n    isRowSelected,\n    getSelectedRows,\n\n    // Column visibility\n    toggleColumnVisibility,\n    setColumnVisibility,\n    getVisibleColumns,\n\n    // Data access\n    getPaginatedData,\n    getProcessedData,\n    getCellValue,\n\n    // Reset\n    reset,\n  };\n}\n","import { useCallback, useMemo, useState } from \"react\";\nimport type {\n  BulkSelectionState,\n  SelectableItem,\n  SelectionState,\n  UseBulkSelectorOptions,\n  UseBulkSelectorReturn,\n} from \"./types\";\n\n/**\n * Default function to get item ID\n */\nfunction defaultGetItemId<T extends SelectableItem>(item: T): string {\n  return item.id;\n}\n\n/**\n * Default function to check if item is selectable\n */\nfunction defaultIsItemSelectable(): boolean {\n  return true;\n}\n\n/**\n * Hook for bulk selection functionality\n *\n * Provides \"select all\", partial selection, and range selection\n * capabilities for lists of items.\n *\n * @example\n * ```tsx\n * const { state, toggle, toggleAll, isSelected } = useBulkSelector({\n *   items: employees,\n *   onSelectionChange: (ids, items) => {\n *     console.log(`Selected ${items.length} employees`);\n *   },\n * });\n *\n * // In your list:\n * {employees.map(emp => (\n *   <label key={emp.id}>\n *     <input\n *       type=\"checkbox\"\n *       checked={isSelected(emp.id)}\n *       onChange={() => toggle(emp.id)}\n *     />\n *     {emp.name}\n *   </label>\n * ))}\n *\n * // Select all checkbox:\n * <input\n *   type=\"checkbox\"\n *   checked={state.isAllSelected}\n *   ref={el => el && (el.indeterminate = state.isPartiallySelected)}\n *   onChange={toggleAll}\n * />\n * ```\n */\nexport function useBulkSelector<T extends SelectableItem>(\n  options: UseBulkSelectorOptions<T>\n): UseBulkSelectorReturn<T> {\n  const {\n    items,\n    initialSelectedIds = [],\n    getItemId = defaultGetItemId,\n    isItemSelectable = defaultIsItemSelectable,\n    maxSelection,\n    onSelectionChange,\n  } = options;\n\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(\n    () => new Set(initialSelectedIds)\n  );\n\n  // Get selectable items\n  const selectableItems = useMemo(\n    () => items.filter(isItemSelectable),\n    [items, isItemSelectable]\n  );\n\n  const selectableIds = useMemo(\n    () => new Set(selectableItems.map(getItemId)),\n    [selectableItems, getItemId]\n  );\n\n  // Calculate selection state\n  const state: BulkSelectionState = useMemo(() => {\n    // Only count selected IDs that are actually in the current selectable items\n    const validSelectedIds = new Set(\n      Array.from(selectedIds).filter((id) => selectableIds.has(id))\n    );\n    const selectedCount = validSelectedIds.size;\n    const totalCount = selectableItems.length;\n\n    let selectionState: SelectionState = \"none\";\n    if (selectedCount === 0) {\n      selectionState = \"none\";\n    } else if (selectedCount === totalCount && totalCount > 0) {\n      selectionState = \"all\";\n    } else {\n      selectionState = \"some\";\n    }\n\n    return {\n      selectedIds: validSelectedIds,\n      selectionState,\n      selectedCount,\n      totalCount,\n      isAllSelected: selectionState === \"all\",\n      isPartiallySelected: selectionState === \"some\",\n      isNoneSelected: selectionState === \"none\",\n    };\n  }, [selectedIds, selectableIds, selectableItems.length]);\n\n  // Notify selection change\n  const notifyChange = useCallback(\n    (newSelectedIds: Set<string>) => {\n      if (onSelectionChange) {\n        const ids = Array.from(newSelectedIds);\n        const selectedItems = items.filter((item) =>\n          newSelectedIds.has(getItemId(item))\n        );\n        onSelectionChange(ids, selectedItems);\n      }\n    },\n    [items, getItemId, onSelectionChange]\n  );\n\n  // Selection actions\n  const select = useCallback(\n    (id: string) => {\n      if (!selectableIds.has(id)) return;\n      if (maxSelection && selectedIds.size >= maxSelection && !selectedIds.has(id)) {\n        return;\n      }\n\n      setSelectedIds((prev) => {\n        if (prev.has(id)) return prev;\n        const newSet = new Set(prev);\n        newSet.add(id);\n        notifyChange(newSet);\n        return newSet;\n      });\n    },\n    [selectableIds, maxSelection, selectedIds.size, notifyChange]\n  );\n\n  const deselect = useCallback(\n    (id: string) => {\n      setSelectedIds((prev) => {\n        if (!prev.has(id)) return prev;\n        const newSet = new Set(prev);\n        newSet.delete(id);\n        notifyChange(newSet);\n        return newSet;\n      });\n    },\n    [notifyChange]\n  );\n\n  const toggle = useCallback(\n    (id: string) => {\n      if (!selectableIds.has(id)) return;\n\n      setSelectedIds((prev) => {\n        const newSet = new Set(prev);\n        if (newSet.has(id)) {\n          newSet.delete(id);\n        } else {\n          if (maxSelection && newSet.size >= maxSelection) {\n            return prev;\n          }\n          newSet.add(id);\n        }\n        notifyChange(newSet);\n        return newSet;\n      });\n    },\n    [selectableIds, maxSelection, notifyChange]\n  );\n\n  const selectAll = useCallback(() => {\n    const allIds = selectableItems.map(getItemId);\n    const idsToSelect = maxSelection ? allIds.slice(0, maxSelection) : allIds;\n    const newSet = new Set(idsToSelect);\n    setSelectedIds(newSet);\n    notifyChange(newSet);\n  }, [selectableItems, getItemId, maxSelection, notifyChange]);\n\n  const deselectAll = useCallback(() => {\n    const newSet = new Set<string>();\n    setSelectedIds(newSet);\n    notifyChange(newSet);\n  }, [notifyChange]);\n\n  const toggleAll = useCallback(() => {\n    if (state.isAllSelected) {\n      deselectAll();\n    } else {\n      selectAll();\n    }\n  }, [state.isAllSelected, selectAll, deselectAll]);\n\n  const selectMany = useCallback(\n    (ids: string[]) => {\n      setSelectedIds((prev) => {\n        const newSet = new Set(prev);\n        let count = newSet.size;\n\n        for (const id of ids) {\n          if (selectableIds.has(id) && !newSet.has(id)) {\n            if (maxSelection && count >= maxSelection) break;\n            newSet.add(id);\n            count++;\n          }\n        }\n\n        if (newSet.size === prev.size) return prev;\n        notifyChange(newSet);\n        return newSet;\n      });\n    },\n    [selectableIds, maxSelection, notifyChange]\n  );\n\n  const deselectMany = useCallback(\n    (ids: string[]) => {\n      setSelectedIds((prev) => {\n        const newSet = new Set(prev);\n        let changed = false;\n\n        for (const id of ids) {\n          if (newSet.has(id)) {\n            newSet.delete(id);\n            changed = true;\n          }\n        }\n\n        if (!changed) return prev;\n        notifyChange(newSet);\n        return newSet;\n      });\n    },\n    [notifyChange]\n  );\n\n  const setSelection = useCallback(\n    (ids: string[]) => {\n      const validIds = ids.filter((id) => selectableIds.has(id));\n      const limitedIds = maxSelection ? validIds.slice(0, maxSelection) : validIds;\n      const newSet = new Set(limitedIds);\n      setSelectedIds(newSet);\n      notifyChange(newSet);\n    },\n    [selectableIds, maxSelection, notifyChange]\n  );\n\n  // Query helpers\n  const isSelected = useCallback((id: string) => selectedIds.has(id), [selectedIds]);\n\n  const canSelect = useCallback(\n    (id: string) => {\n      if (!selectableIds.has(id)) return false;\n      if (selectedIds.has(id)) return true; // Can always deselect\n      if (maxSelection && selectedIds.size >= maxSelection) return false;\n      return true;\n    },\n    [selectableIds, selectedIds, maxSelection]\n  );\n\n  const getSelectedItems = useCallback(\n    () => items.filter((item) => selectedIds.has(getItemId(item))),\n    [items, selectedIds, getItemId]\n  );\n\n  const getSelectedIds = useCallback(\n    () => Array.from(selectedIds),\n    [selectedIds]\n  );\n\n  // Range selection\n  const selectRange = useCallback(\n    (fromId: string, toId: string) => {\n      const fromIndex = selectableItems.findIndex(\n        (item) => getItemId(item) === fromId\n      );\n      const toIndex = selectableItems.findIndex(\n        (item) => getItemId(item) === toId\n      );\n\n      if (fromIndex === -1 || toIndex === -1) return;\n\n      const start = Math.min(fromIndex, toIndex);\n      const end = Math.max(fromIndex, toIndex);\n\n      const rangeIds = selectableItems\n        .slice(start, end + 1)\n        .map(getItemId);\n\n      selectMany(rangeIds);\n    },\n    [selectableItems, getItemId, selectMany]\n  );\n\n  // Reset\n  const reset = useCallback(() => {\n    const newSet = new Set(initialSelectedIds);\n    setSelectedIds(newSet);\n    notifyChange(newSet);\n  }, [initialSelectedIds, notifyChange]);\n\n  return {\n    state,\n\n    // Selection actions\n    select,\n    deselect,\n    toggle,\n    selectAll,\n    deselectAll,\n    toggleAll,\n    selectMany,\n    deselectMany,\n    setSelection,\n\n    // Query helpers\n    isSelected,\n    canSelect,\n    getSelectedItems,\n    getSelectedIds,\n\n    // Range selection\n    selectRange,\n\n    // Reset\n    reset,\n  };\n}\n","import { useCallback, useMemo, useState } from \"react\";\nimport type {\n  ApprovalAction,\n  ApprovalFlowState,\n  ApprovalStep,\n  ApprovalStepStatus,\n  ApprovalWorkflow,\n  ApprovalWorkflowStatus,\n  Approver,\n  UseApprovalFlowOptions,\n  UseApprovalFlowReturn,\n} from \"./types\";\n\n/**\n * Calculate workflow status based on step statuses\n */\nfunction calculateWorkflowStatus(steps: ApprovalStep[]): ApprovalWorkflowStatus {\n  if (steps.length === 0) return \"draft\";\n\n  const hasRejected = steps.some((s) => s.status === \"rejected\");\n  if (hasRejected) return \"rejected\";\n\n  const hasCancelled = steps.some((s) => s.status === \"cancelled\");\n  if (hasCancelled) return \"cancelled\";\n\n  const allComplete = steps.every(\n    (s) =>\n      s.status === \"approved\" || s.status === \"skipped\" || (s.optional && s.status === \"pending\")\n  );\n  if (allComplete) return \"approved\";\n\n  const hasInProgress = steps.some(\n    (s) => s.status === \"in_review\" || s.status === \"approved\"\n  );\n  if (hasInProgress) return \"in_progress\";\n\n  const hasPending = steps.some((s) => s.status === \"pending\");\n  if (hasPending) return \"pending\";\n\n  return \"draft\";\n}\n\n/**\n * Find the current active step index\n */\nfunction findCurrentStepIndex(steps: ApprovalStep[]): number {\n  // Find the first step that is pending or in_review\n  const activeIndex = steps.findIndex(\n    (s) => s.status === \"pending\" || s.status === \"in_review\"\n  );\n\n  if (activeIndex >= 0) return activeIndex;\n\n  // If all steps are complete, return the last step\n  const allComplete = steps.every(\n    (s) => s.status === \"approved\" || s.status === \"skipped\" || s.status === \"rejected\"\n  );\n  if (allComplete && steps.length > 0) {\n    return steps.length - 1;\n  }\n\n  return 0;\n}\n\n/**\n * Check if a step has enough approvals\n */\nfunction hasEnoughApprovals(step: ApprovalStep): boolean {\n  const approvalCount = step.actions.filter((a) => a.type === \"approve\").length;\n  return approvalCount >= step.minApprovals;\n}\n\n/**\n * Hook for approval workflow state management\n *\n * Provides functionality for multi-step approval workflows\n * with support for multiple approvers, delegation, and tracking.\n *\n * @example\n * ```tsx\n * const { state, approve, reject, canApprove } = useApprovalFlow({\n *   workflow: purchaseOrderWorkflow,\n *   currentUser: currentEmployee,\n *   onApproved: (workflow) => {\n *     createPurchaseOrder(workflow.targetEntity.id);\n *   },\n *   onRejected: (workflow) => {\n *     notifyInitiator(workflow.initiator);\n *   },\n * });\n *\n * // Display progress\n * <ProgressBar value={state.progress} />\n *\n * // Render steps\n * {state.workflow.steps.map(step => (\n *   <StepCard\n *     key={step.id}\n *     step={step}\n *     isCurrent={isCurrentStep(step.id)}\n *     onApprove={() => approve(step.id)}\n *     onReject={() => reject(step.id)}\n *   />\n * ))}\n * ```\n */\nexport function useApprovalFlow(\n  options: UseApprovalFlowOptions\n): UseApprovalFlowReturn {\n  const {\n    workflow: initialWorkflow,\n    currentUser,\n    onStepChange,\n    onWorkflowChange,\n    onApproved,\n    onRejected,\n  } = options;\n\n  const [workflow, setWorkflow] = useState<ApprovalWorkflow>(initialWorkflow);\n  const [viewingStepIndex, setViewingStepIndex] = useState<number | null>(null);\n\n  // Update workflow and trigger callbacks\n  const updateWorkflow = useCallback(\n    (\n      updater: (prev: ApprovalWorkflow) => ApprovalWorkflow,\n      changedStep?: ApprovalStep\n    ) => {\n      setWorkflow((prev) => {\n        const updated = updater(prev);\n\n        // Calculate new workflow status\n        const newStatus = calculateWorkflowStatus(updated.steps);\n        const finalWorkflow: ApprovalWorkflow = {\n          ...updated,\n          status: newStatus,\n          updatedAt: new Date(),\n        };\n\n        // Trigger callbacks\n        if (changedStep) {\n          onStepChange?.(changedStep, finalWorkflow);\n        }\n        onWorkflowChange?.(finalWorkflow);\n\n        if (newStatus === \"approved\" && prev.status !== \"approved\") {\n          onApproved?.(finalWorkflow);\n        }\n        if (newStatus === \"rejected\" && prev.status !== \"rejected\") {\n          onRejected?.(finalWorkflow);\n        }\n\n        return finalWorkflow;\n      });\n    },\n    [onStepChange, onWorkflowChange, onApproved, onRejected]\n  );\n\n  // Calculate state\n  const state: ApprovalFlowState = useMemo(() => {\n    const steps = workflow.steps;\n    const currentStepIndex =\n      viewingStepIndex ?? findCurrentStepIndex(steps);\n    const currentStep = steps[currentStepIndex] ?? null;\n\n    const completedSteps = steps.filter(\n      (s) => s.status === \"approved\" || s.status === \"skipped\"\n    );\n    const pendingSteps = steps.filter(\n      (s) => s.status === \"pending\" || s.status === \"in_review\"\n    );\n\n    // Calculate progress\n    const totalSteps = steps.filter((s) => !s.optional).length;\n    const completedCount = completedSteps.filter((s) => !s.optional).length;\n    const progress = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;\n\n    // Find user's pending action\n    let userPendingAction: ApprovalStep | null = null;\n    if (currentUser) {\n      userPendingAction =\n        pendingSteps.find((step) =>\n          step.requiredApprovers.some((a) => a.id === currentUser.id)\n        ) ?? null;\n    }\n\n    return {\n      workflow,\n      currentStepIndex,\n      currentStep,\n      completedSteps,\n      pendingSteps,\n      progress,\n      isComplete: workflow.status === \"approved\" || workflow.status === \"rejected\",\n      isApproved: workflow.status === \"approved\",\n      isRejected: workflow.status === \"rejected\",\n      canCancel:\n        workflow.status !== \"cancelled\" &&\n        workflow.status !== \"approved\" &&\n        workflow.status !== \"rejected\",\n      userPendingAction,\n    };\n  }, [workflow, viewingStepIndex, currentUser]);\n\n  // Helper to create an action\n  const createAction = useCallback(\n    (\n      type: ApprovalAction[\"type\"],\n      comment?: string,\n      delegatedTo?: Approver\n    ): ApprovalAction => {\n      const action: ApprovalAction = {\n        type,\n        approver: currentUser ?? {\n          id: \"system\",\n          name: \"System\",\n        },\n        timestamp: new Date(),\n      };\n\n      // Only add optional properties when defined (exactOptionalPropertyTypes)\n      if (comment !== undefined) {\n        action.comment = comment;\n      }\n      if (delegatedTo !== undefined) {\n        action.delegatedTo = delegatedTo;\n      }\n\n      return action;\n    },\n    [currentUser]\n  );\n\n  // Update a specific step\n  const updateStep = useCallback(\n    (\n      stepId: string,\n      updater: (step: ApprovalStep) => ApprovalStep\n    ) => {\n      updateWorkflow((prev) => {\n        const stepIndex = prev.steps.findIndex((s) => s.id === stepId);\n        if (stepIndex === -1) return prev;\n\n        const existingStep = prev.steps[stepIndex];\n        // Guard against undefined (noUncheckedIndexedAccess)\n        if (!existingStep) return prev;\n\n        const updatedStep = updater(existingStep);\n        const newSteps = [...prev.steps];\n        newSteps[stepIndex] = updatedStep;\n\n        return { ...prev, steps: newSteps };\n      });\n    },\n    [updateWorkflow]\n  );\n\n  // Step actions\n  const approve = useCallback(\n    (stepId?: string, comment?: string) => {\n      const targetStepId = stepId ?? state.currentStep?.id;\n      if (!targetStepId) return;\n\n      updateStep(targetStepId, (step) => {\n        const action = createAction(\"approve\", comment);\n        const newActions = [...step.actions, action];\n        const newStep = { ...step, actions: newActions };\n\n        // Check if step now has enough approvals\n        if (hasEnoughApprovals(newStep)) {\n          newStep.status = \"approved\";\n        } else {\n          newStep.status = \"in_review\";\n        }\n\n        return newStep;\n      });\n    },\n    [state.currentStep, updateStep, createAction]\n  );\n\n  const reject = useCallback(\n    (stepId?: string, comment?: string) => {\n      const targetStepId = stepId ?? state.currentStep?.id;\n      if (!targetStepId) return;\n\n      updateStep(targetStepId, (step) => {\n        const action = createAction(\"reject\", comment);\n        return {\n          ...step,\n          status: \"rejected\" as ApprovalStepStatus,\n          actions: [...step.actions, action],\n        };\n      });\n    },\n    [state.currentStep, updateStep, createAction]\n  );\n\n  const requestChanges = useCallback(\n    (stepId?: string, comment?: string) => {\n      const targetStepId = stepId ?? state.currentStep?.id;\n      if (!targetStepId) return;\n\n      updateStep(targetStepId, (step) => {\n        const action = createAction(\"request_changes\", comment);\n        return {\n          ...step,\n          status: \"pending\" as ApprovalStepStatus,\n          actions: [...step.actions, action],\n        };\n      });\n    },\n    [state.currentStep, updateStep, createAction]\n  );\n\n  const delegate = useCallback(\n    (stepId: string, delegateTo: Approver, comment?: string) => {\n      updateStep(stepId, (step) => {\n        const action = createAction(\"delegate\", comment, delegateTo);\n        const newApprovers = step.requiredApprovers.some(\n          (a) => a.id === delegateTo.id\n        )\n          ? step.requiredApprovers\n          : [...step.requiredApprovers, delegateTo];\n\n        return {\n          ...step,\n          requiredApprovers: newApprovers,\n          actions: [...step.actions, action],\n        };\n      });\n    },\n    [updateStep, createAction]\n  );\n\n  const skipStep = useCallback(\n    (stepId: string, comment?: string) => {\n      updateStep(stepId, (step) => {\n        if (!step.optional) return step;\n\n        const action = createAction(\"skip\", comment);\n        return {\n          ...step,\n          status: \"skipped\" as ApprovalStepStatus,\n          actions: [...step.actions, action],\n        };\n      });\n    },\n    [updateStep, createAction]\n  );\n\n  // Workflow actions\n  const cancel = useCallback(\n    (comment?: string) => {\n      updateWorkflow((prev) => ({\n        ...prev,\n        status: \"cancelled\",\n        steps: prev.steps.map((step) =>\n          step.status === \"pending\" || step.status === \"in_review\"\n            ? {\n                ...step,\n                status: \"cancelled\" as ApprovalStepStatus,\n                actions: [\n                  ...step.actions,\n                  createAction(\"skip\", comment ?? \"Workflow cancelled\"),\n                ],\n              }\n            : step\n        ),\n      }));\n    },\n    [updateWorkflow, createAction]\n  );\n\n  const resetToDraft = useCallback(() => {\n    updateWorkflow((prev) => ({\n      ...prev,\n      status: \"draft\",\n      steps: prev.steps.map((step) => ({\n        ...step,\n        status: \"pending\" as ApprovalStepStatus,\n        actions: [],\n      })),\n    }));\n  }, [updateWorkflow]);\n\n  const restart = useCallback(() => {\n    updateWorkflow((prev) => ({\n      ...prev,\n      status: \"pending\",\n      steps: prev.steps.map((step, index) => ({\n        ...step,\n        status:\n          index === 0\n            ? (\"in_review\" as ApprovalStepStatus)\n            : (\"pending\" as ApprovalStepStatus),\n        actions: [],\n      })),\n    }));\n  }, [updateWorkflow]);\n\n  // Query helpers\n  const canApprove = useCallback(\n    (stepId: string, userId?: string) => {\n      const step = workflow.steps.find((s) => s.id === stepId);\n      if (!step) return false;\n      if (step.status !== \"pending\" && step.status !== \"in_review\") return false;\n\n      const checkUserId = userId ?? currentUser?.id;\n      if (!checkUserId) return false;\n\n      // Check if user is a required approver\n      const isApprover = step.requiredApprovers.some((a) => a.id === checkUserId);\n      if (!isApprover) return false;\n\n      // Check if user hasn't already approved\n      const hasAlreadyApproved = step.actions.some(\n        (a) => a.type === \"approve\" && a.approver.id === checkUserId\n      );\n\n      return !hasAlreadyApproved;\n    },\n    [workflow.steps, currentUser]\n  );\n\n  const canReject = useCallback(\n    (stepId: string, userId?: string) => {\n      const step = workflow.steps.find((s) => s.id === stepId);\n      if (!step) return false;\n      if (step.status !== \"pending\" && step.status !== \"in_review\") return false;\n\n      const checkUserId = userId ?? currentUser?.id;\n      if (!checkUserId) return false;\n\n      return step.requiredApprovers.some((a) => a.id === checkUserId);\n    },\n    [workflow.steps, currentUser]\n  );\n\n  const isCurrentStep = useCallback(\n    (stepId: string) => state.currentStep?.id === stepId,\n    [state.currentStep]\n  );\n\n  const isStepComplete = useCallback(\n    (stepId: string) => {\n      const step = workflow.steps.find((s) => s.id === stepId);\n      return step?.status === \"approved\" || step?.status === \"skipped\";\n    },\n    [workflow.steps]\n  );\n\n  const getStep = useCallback(\n    (stepId: string) => workflow.steps.find((s) => s.id === stepId),\n    [workflow.steps]\n  );\n\n  const getStepApprovers = useCallback(\n    (stepId: string) => {\n      const step = workflow.steps.find((s) => s.id === stepId);\n      return step?.requiredApprovers ?? [];\n    },\n    [workflow.steps]\n  );\n\n  const getRemainingApprovers = useCallback(\n    (stepId: string) => {\n      const step = workflow.steps.find((s) => s.id === stepId);\n      if (!step) return [];\n\n      const approvedUserIds = new Set(\n        step.actions.filter((a) => a.type === \"approve\").map((a) => a.approver.id)\n      );\n\n      return step.requiredApprovers.filter((a) => !approvedUserIds.has(a.id));\n    },\n    [workflow.steps]\n  );\n\n  // Navigation\n  const goToStep = useCallback(\n    (stepId: string) => {\n      const index = workflow.steps.findIndex((s) => s.id === stepId);\n      if (index >= 0) {\n        setViewingStepIndex(index);\n      }\n    },\n    [workflow.steps]\n  );\n\n  const getNextStep = useCallback((): ApprovalStep | null => {\n    const nextIndex = state.currentStepIndex + 1;\n    const nextStep = workflow.steps[nextIndex];\n    return nextStep !== undefined ? nextStep : null;\n  }, [workflow.steps, state.currentStepIndex]);\n\n  const getPreviousStep = useCallback((): ApprovalStep | null => {\n    const prevIndex = state.currentStepIndex - 1;\n    if (prevIndex < 0) return null;\n    const prevStep = workflow.steps[prevIndex];\n    return prevStep !== undefined ? prevStep : null;\n  }, [workflow.steps, state.currentStepIndex]);\n\n  return {\n    state,\n\n    // Step actions\n    approve,\n    reject,\n    requestChanges,\n    delegate,\n    skipStep,\n\n    // Workflow actions\n    cancel,\n    resetToDraft,\n    restart,\n\n    // Query helpers\n    canApprove,\n    canReject,\n    isCurrentStep,\n    isStepComplete,\n    getStep,\n    getStepApprovers,\n    getRemainingApprovers,\n\n    // Navigation\n    goToStep,\n    getNextStep,\n    getPreviousStep,\n  };\n}\n","/**\n * SpendingMeter Types\n *\n * Type definitions for budget usage gauge component\n * with threshold calculations and warning states.\n */\n\n/**\n * Spending threshold level\n */\nexport type ThresholdLevel = \"safe\" | \"warning\" | \"danger\" | \"exceeded\";\n\n/**\n * Spending period type\n */\nexport type SpendingPeriod =\n  | \"daily\"\n  | \"weekly\"\n  | \"monthly\"\n  | \"quarterly\"\n  | \"yearly\"\n  | \"custom\";\n\n/**\n * Currency configuration\n */\nexport interface CurrencyConfig {\n  /** Currency code (e.g., 'EUR', 'USD') */\n  code: string;\n  /** Currency symbol (e.g., '$', '???') */\n  symbol: string;\n  /** Decimal places */\n  decimals: number;\n  /** Symbol position */\n  symbolPosition: \"before\" | \"after\";\n  /** Thousands separator */\n  thousandsSeparator: string;\n  /** Decimal separator */\n  decimalSeparator: string;\n}\n\n/**\n * Spending threshold configuration\n */\nexport interface SpendingThreshold {\n  /** Threshold level name */\n  level: ThresholdLevel;\n  /** Percentage at which this threshold starts (0-100) */\n  percentage: number;\n  /** Custom label for this threshold */\n  label?: string;\n  /** Color associated with this threshold */\n  color?: string;\n}\n\n/**\n * Spending limit configuration\n */\nexport interface SpendingLimit {\n  /** Unique limit ID */\n  id: string;\n  /** Limit name/label */\n  name: string;\n  /** Maximum spending amount */\n  maxAmount: number;\n  /** Current spent amount */\n  spentAmount: number;\n  /** Spending period */\n  period: SpendingPeriod;\n  /** Period start date */\n  periodStart: Date;\n  /** Period end date */\n  periodEnd: Date;\n  /** Currency configuration */\n  currency: CurrencyConfig;\n  /** Custom thresholds */\n  thresholds?: SpendingThreshold[];\n  /** Whether this limit is active */\n  isActive: boolean;\n  /** Whether to allow exceeding the limit */\n  allowExceed: boolean;\n  /** Soft limit (warning threshold) */\n  softLimit?: number;\n  /** Hard limit (absolute maximum) */\n  hardLimit?: number;\n}\n\n/**\n * Spending meter state\n */\nexport interface SpendingMeterState {\n  /** Current spending limit configuration */\n  limit: SpendingLimit;\n  /** Amount spent */\n  spent: number;\n  /** Remaining amount */\n  remaining: number;\n  /** Usage percentage (0-100+) */\n  percentage: number;\n  /** Capped percentage for display (0-100) */\n  displayPercentage: number;\n  /** Current threshold level */\n  thresholdLevel: ThresholdLevel;\n  /** Active threshold configuration */\n  activeThreshold: SpendingThreshold;\n  /** All thresholds for display */\n  thresholds: SpendingThreshold[];\n  /** Whether limit is exceeded */\n  isExceeded: boolean;\n  /** Whether soft limit is exceeded */\n  isSoftLimitExceeded: boolean;\n  /** Whether hard limit is exceeded */\n  isHardLimitExceeded: boolean;\n  /** Formatted spent amount */\n  formattedSpent: string;\n  /** Formatted remaining amount */\n  formattedRemaining: string;\n  /** Formatted limit amount */\n  formattedLimit: string;\n  /** Days remaining in period */\n  daysRemaining: number;\n  /** Average daily spending */\n  averageDailySpending: number;\n  /** Projected end-of-period spending */\n  projectedSpending: number;\n  /** Whether on track to stay under limit */\n  isOnTrack: boolean;\n}\n\n/**\n * Options for useSpendingMeter hook\n */\nexport interface UseSpendingMeterOptions {\n  /** Spending limit configuration */\n  limit: SpendingLimit;\n  /** Warning threshold percentage (default: 75) */\n  warningThreshold?: number;\n  /** Danger threshold percentage (default: 90) */\n  dangerThreshold?: number;\n  /** Callback when threshold level changes */\n  onThresholdChange?: (level: ThresholdLevel, state: SpendingMeterState) => void;\n  /** Callback when limit is exceeded */\n  onLimitExceeded?: (state: SpendingMeterState) => void;\n  /** Callback when soft limit is exceeded */\n  onSoftLimitExceeded?: (state: SpendingMeterState) => void;\n  /** Custom currency formatter */\n  formatCurrency?: (amount: number, currency: CurrencyConfig) => string;\n}\n\n/**\n * Return type for useSpendingMeter hook\n */\nexport interface UseSpendingMeterReturn {\n  /** Current state */\n  state: SpendingMeterState;\n\n  // Actions\n  /** Update spent amount */\n  setSpent: (amount: number) => void;\n  /** Add to spent amount */\n  addSpending: (amount: number) => void;\n  /** Update limit configuration */\n  updateLimit: (limit: Partial<SpendingLimit>) => void;\n  /** Reset spending to zero */\n  resetSpending: () => void;\n\n  // Query helpers\n  /** Check if an amount can be spent */\n  canSpend: (amount: number) => boolean;\n  /** Get amount that can still be spent */\n  getSpendableAmount: () => number;\n  /** Check if spending amount would trigger warning */\n  wouldTriggerWarning: (amount: number) => boolean;\n  /** Check if spending amount would exceed limit */\n  wouldExceedLimit: (amount: number) => boolean;\n\n  // Formatting helpers\n  /** Format an amount with currency */\n  formatAmount: (amount: number) => string;\n  /** Get percentage for a given amount */\n  getPercentage: (amount: number) => number;\n  /** Get threshold level for a given percentage */\n  getThresholdLevel: (percentage: number) => ThresholdLevel;\n}\n\n/**\n * Default thresholds\n */\nexport const DEFAULT_THRESHOLDS: SpendingThreshold[] = [\n  { level: \"safe\", percentage: 0, label: \"On Track\", color: \"#22c55e\" },\n  { level: \"warning\", percentage: 75, label: \"Approaching Limit\", color: \"#f59e0b\" },\n  { level: \"danger\", percentage: 90, label: \"Near Limit\", color: \"#ef4444\" },\n  { level: \"exceeded\", percentage: 100, label: \"Limit Exceeded\", color: \"#dc2626\" },\n];\n\n/**\n * Default currency configuration (EUR)\n */\nexport const DEFAULT_CURRENCY: CurrencyConfig = {\n  code: \"EUR\",\n  symbol: \"\\u20AC\",\n  decimals: 2,\n  symbolPosition: \"after\",\n  thousandsSeparator: \" \",\n  decimalSeparator: \",\",\n};\n","import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport type {\n  CurrencyConfig,\n  SpendingLimit,\n  SpendingMeterState,\n  SpendingThreshold,\n  ThresholdLevel,\n  UseSpendingMeterOptions,\n  UseSpendingMeterReturn,\n} from \"./types\";\nimport { DEFAULT_CURRENCY, DEFAULT_THRESHOLDS } from \"./types\";\n\n/**\n * Default currency formatter\n */\nfunction defaultFormatCurrency(amount: number, currency: CurrencyConfig): string {\n  const absAmount = Math.abs(amount);\n  const sign = amount < 0 ? \"-\" : \"\";\n\n  // Format the number\n  const parts = absAmount.toFixed(currency.decimals).split(\".\");\n  const integerPart = (parts[0] ?? \"0\").replace(\n    /\\B(?=(\\d{3})+(?!\\d))/g,\n    currency.thousandsSeparator\n  );\n  const decimalPart = parts[1];\n\n  const formattedNumber = decimalPart\n    ? `${integerPart}${currency.decimalSeparator}${decimalPart}`\n    : integerPart;\n\n  // Add symbol\n  if (currency.symbolPosition === \"before\") {\n    return `${sign}${currency.symbol}${formattedNumber}`;\n  }\n  return `${sign}${formattedNumber} ${currency.symbol}`;\n}\n\n/**\n * Calculate days between two dates\n */\nfunction daysBetween(start: Date, end: Date): number {\n  const msPerDay = 24 * 60 * 60 * 1000;\n  return Math.ceil((end.getTime() - start.getTime()) / msPerDay);\n}\n\n/**\n * Get threshold level for a percentage\n */\nfunction getThresholdLevelForPercentage(\n  percentage: number,\n  thresholds: SpendingThreshold[]\n): ThresholdLevel {\n  // Sort thresholds by percentage descending\n  const sorted = [...thresholds].sort((a, b) => b.percentage - a.percentage);\n\n  for (const threshold of sorted) {\n    if (percentage >= threshold.percentage) {\n      return threshold.level;\n    }\n  }\n\n  return \"safe\";\n}\n\n/**\n * Get active threshold for a percentage\n */\nfunction getActiveThreshold(\n  percentage: number,\n  thresholds: SpendingThreshold[]\n): SpendingThreshold {\n  const level = getThresholdLevelForPercentage(percentage, thresholds);\n  const found = thresholds.find((t) => t.level === level);\n  if (found) return found;\n\n  // Fallback to first threshold or create a default\n  const first = thresholds[0];\n  return first ?? { level: \"safe\", percentage: 0, label: \"Safe\", color: \"#22c55e\" };\n}\n\n/**\n * Hook for spending meter state management\n *\n * Provides budget tracking with threshold calculations,\n * projections, and warning states.\n *\n * @example\n * ```tsx\n * const { state, addSpending, canSpend } = useSpendingMeter({\n *   limit: employeeSpendingLimit,\n *   onThresholdChange: (level) => {\n *     if (level === 'danger') {\n *       showWarningToast('Approaching spending limit!');\n *     }\n *   },\n *   onLimitExceeded: () => {\n *     showErrorToast('Spending limit exceeded!');\n *   },\n * });\n *\n * // Display gauge\n * <ProgressBar\n *   value={state.displayPercentage}\n *   color={state.activeThreshold.color}\n * />\n * <p>{state.formattedSpent} / {state.formattedLimit}</p>\n * <p>{state.formattedRemaining} remaining</p>\n *\n * // Before making a purchase\n * if (canSpend(orderTotal)) {\n *   addSpending(orderTotal);\n * }\n * ```\n */\nexport function useSpendingMeter(\n  options: UseSpendingMeterOptions\n): UseSpendingMeterReturn {\n  const {\n    limit: initialLimit,\n    warningThreshold = 75,\n    dangerThreshold = 90,\n    onThresholdChange,\n    onLimitExceeded,\n    onSoftLimitExceeded,\n    formatCurrency = defaultFormatCurrency,\n  } = options;\n\n  const [limit, setLimit] = useState<SpendingLimit>(initialLimit);\n  const previousThresholdRef = useRef<ThresholdLevel | null>(null);\n\n  // Build thresholds\n  const thresholds = useMemo((): SpendingThreshold[] => {\n    if (limit.thresholds && limit.thresholds.length > 0) {\n      return limit.thresholds;\n    }\n\n    return [\n      { level: \"safe\", percentage: 0, label: \"On Track\", color: \"#22c55e\" },\n      {\n        level: \"warning\",\n        percentage: warningThreshold,\n        label: \"Approaching Limit\",\n        color: \"#f59e0b\",\n      },\n      {\n        level: \"danger\",\n        percentage: dangerThreshold,\n        label: \"Near Limit\",\n        color: \"#ef4444\",\n      },\n      {\n        level: \"exceeded\",\n        percentage: 100,\n        label: \"Limit Exceeded\",\n        color: \"#dc2626\",\n      },\n    ];\n  }, [limit.thresholds, warningThreshold, dangerThreshold]);\n\n  // Calculate state\n  const state: SpendingMeterState = useMemo(() => {\n    const spent = limit.spentAmount;\n    const maxAmount = limit.maxAmount;\n    const remaining = Math.max(0, maxAmount - spent);\n    const percentage = maxAmount > 0 ? (spent / maxAmount) * 100 : 0;\n    const displayPercentage = Math.min(100, percentage);\n\n    const thresholdLevel = getThresholdLevelForPercentage(percentage, thresholds);\n    const activeThreshold = getActiveThreshold(percentage, thresholds);\n\n    const isExceeded = spent > maxAmount;\n    const isSoftLimitExceeded = limit.softLimit\n      ? spent > limit.softLimit\n      : percentage >= warningThreshold;\n    const isHardLimitExceeded = limit.hardLimit\n      ? spent > limit.hardLimit\n      : isExceeded;\n\n    const currency = limit.currency ?? DEFAULT_CURRENCY;\n    const formattedSpent = formatCurrency(spent, currency);\n    const formattedRemaining = formatCurrency(remaining, currency);\n    const formattedLimit = formatCurrency(maxAmount, currency);\n\n    // Period calculations\n    const now = new Date();\n    const daysInPeriod = daysBetween(limit.periodStart, limit.periodEnd);\n    const daysElapsed = Math.max(1, daysBetween(limit.periodStart, now));\n    const daysRemaining = Math.max(0, daysBetween(now, limit.periodEnd));\n\n    const averageDailySpending = spent / daysElapsed;\n    const projectedSpending = averageDailySpending * daysInPeriod;\n    const isOnTrack = projectedSpending <= maxAmount;\n\n    return {\n      limit,\n      spent,\n      remaining,\n      percentage,\n      displayPercentage,\n      thresholdLevel,\n      activeThreshold,\n      thresholds,\n      isExceeded,\n      isSoftLimitExceeded,\n      isHardLimitExceeded,\n      formattedSpent,\n      formattedRemaining,\n      formattedLimit,\n      daysRemaining,\n      averageDailySpending,\n      projectedSpending,\n      isOnTrack,\n    };\n  }, [limit, thresholds, warningThreshold, formatCurrency]);\n\n  // Track threshold changes and trigger callbacks\n  useEffect(() => {\n    const currentLevel = state.thresholdLevel;\n\n    if (previousThresholdRef.current !== null) {\n      if (previousThresholdRef.current !== currentLevel) {\n        onThresholdChange?.(currentLevel, state);\n      }\n    }\n\n    previousThresholdRef.current = currentLevel;\n  }, [state.thresholdLevel, state, onThresholdChange]);\n\n  // Track limit exceeded\n  useEffect(() => {\n    if (state.isExceeded) {\n      onLimitExceeded?.(state);\n    }\n  }, [state.isExceeded, state, onLimitExceeded]);\n\n  // Track soft limit exceeded\n  useEffect(() => {\n    if (state.isSoftLimitExceeded) {\n      onSoftLimitExceeded?.(state);\n    }\n  }, [state.isSoftLimitExceeded, state, onSoftLimitExceeded]);\n\n  // Actions\n  const setSpent = useCallback((amount: number) => {\n    setLimit((prev) => ({\n      ...prev,\n      spentAmount: Math.max(0, amount),\n    }));\n  }, []);\n\n  const addSpending = useCallback((amount: number) => {\n    setLimit((prev) => ({\n      ...prev,\n      spentAmount: Math.max(0, prev.spentAmount + amount),\n    }));\n  }, []);\n\n  const updateLimit = useCallback((updates: Partial<SpendingLimit>) => {\n    setLimit((prev) => ({\n      ...prev,\n      ...updates,\n    }));\n  }, []);\n\n  const resetSpending = useCallback(() => {\n    setLimit((prev) => ({\n      ...prev,\n      spentAmount: 0,\n    }));\n    previousThresholdRef.current = null;\n  }, []);\n\n  // Query helpers\n  const canSpend = useCallback(\n    (amount: number): boolean => {\n      if (!limit.isActive) return true;\n      if (limit.allowExceed) return true;\n\n      const newTotal = limit.spentAmount + amount;\n\n      if (limit.hardLimit && newTotal > limit.hardLimit) {\n        return false;\n      }\n\n      return newTotal <= limit.maxAmount;\n    },\n    [limit]\n  );\n\n  const getSpendableAmount = useCallback((): number => {\n    if (!limit.isActive || limit.allowExceed) {\n      return Infinity;\n    }\n\n    const maxAllowed = limit.hardLimit ?? limit.maxAmount;\n    return Math.max(0, maxAllowed - limit.spentAmount);\n  }, [limit]);\n\n  const wouldTriggerWarning = useCallback(\n    (amount: number): boolean => {\n      const newPercentage =\n        ((limit.spentAmount + amount) / limit.maxAmount) * 100;\n      return newPercentage >= warningThreshold;\n    },\n    [limit, warningThreshold]\n  );\n\n  const wouldExceedLimit = useCallback(\n    (amount: number): boolean => {\n      return limit.spentAmount + amount > limit.maxAmount;\n    },\n    [limit]\n  );\n\n  // Formatting helpers\n  const formatAmount = useCallback(\n    (amount: number): string => {\n      return formatCurrency(amount, limit.currency ?? DEFAULT_CURRENCY);\n    },\n    [formatCurrency, limit.currency]\n  );\n\n  const getPercentage = useCallback(\n    (amount: number): number => {\n      return limit.maxAmount > 0 ? (amount / limit.maxAmount) * 100 : 0;\n    },\n    [limit.maxAmount]\n  );\n\n  const getThresholdLevel = useCallback(\n    (percentage: number): ThresholdLevel => {\n      return getThresholdLevelForPercentage(percentage, thresholds);\n    },\n    [thresholds]\n  );\n\n  return {\n    state,\n\n    // Actions\n    setSpent,\n    addSpending,\n    updateLimit,\n    resetSpending,\n\n    // Query helpers\n    canSpend,\n    getSpendableAmount,\n    wouldTriggerWarning,\n    wouldExceedLimit,\n\n    // Formatting helpers\n    formatAmount,\n    getPercentage,\n    getThresholdLevel,\n  };\n}\n","import { useCallback, useMemo, useState } from \"react\";\nimport type {\n  CartItem,\n  Quote,\n  QuoteBuilderState,\n  QuoteCustomer,\n  QuoteDiscount,\n  QuoteLineItem,\n  QuotePricing,\n  QuoteTerms,\n  QuoteValidationError,\n  TaxType,\n  UseQuoteBuilderOptions,\n  UseQuoteBuilderReturn,\n} from \"./types\";\n\n/**\n * Generate a unique ID\n */\nfunction generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n}\n\n/**\n * Default quote number generator\n */\nfunction defaultGenerateQuoteNumber(): string {\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, \"0\");\n  const random = Math.random().toString(36).substring(2, 6).toUpperCase();\n  return `Q-${year}${month}-${random}`;\n}\n\n/**\n * Calculate effective unit price after discount\n */\nfunction calculateEffectiveUnitPrice(\n  unitPrice: number,\n  discount?: QuoteLineItem[\"discount\"]\n): number {\n  if (!discount) return unitPrice;\n\n  switch (discount.type) {\n    case \"percentage\":\n      return unitPrice * (1 - discount.value / 100);\n    case \"fixed\":\n      return Math.max(0, unitPrice - discount.value);\n    case \"per_unit\":\n      return Math.max(0, unitPrice - discount.value);\n    default:\n      return unitPrice;\n  }\n}\n\n/**\n * Calculate line total\n */\nfunction calculateLineTotal(\n  effectiveUnitPrice: number,\n  quantity: number,\n  taxRate?: number,\n  includeTax?: boolean\n): { lineTotal: number; taxAmount: number } {\n  const subtotal = effectiveUnitPrice * quantity;\n  const taxAmount = taxRate ? subtotal * (taxRate / 100) : 0;\n  const lineTotal = includeTax ? subtotal + taxAmount : subtotal;\n\n  return { lineTotal, taxAmount };\n}\n\n/**\n * Calculate quote-level discount amount\n */\nfunction calculateQuoteDiscount(\n  subtotal: number,\n  discount: QuoteDiscount\n): number {\n  if (discount.minOrderValue && subtotal < discount.minOrderValue) {\n    return 0;\n  }\n\n  let amount: number;\n  switch (discount.type) {\n    case \"percentage\":\n      amount = subtotal * (discount.value / 100);\n      break;\n    case \"fixed\":\n      amount = discount.value;\n      break;\n    default:\n      amount = 0;\n  }\n\n  if (discount.maxDiscount) {\n    amount = Math.min(amount, discount.maxDiscount);\n  }\n\n  return amount;\n}\n\n/**\n * Calculate complete pricing summary\n */\nfunction calculatePricing(\n  items: QuoteLineItem[],\n  discounts: QuoteDiscount[],\n  shipping: number,\n  taxRate: number,\n  taxType: TaxType,\n  currency: string\n): QuotePricing {\n  // Calculate subtotal from all line items\n  const subtotal = items.reduce((sum, item) => sum + item.lineTotal, 0);\n\n  // Calculate total discounts\n  const discountTotal = discounts.reduce(\n    (sum, discount) => sum + calculateQuoteDiscount(subtotal, discount),\n    0\n  );\n\n  // Discounted subtotal\n  const discountedSubtotal = Math.max(0, subtotal - discountTotal);\n\n  // Calculate tax\n  let taxAmount = 0;\n  if (taxType !== \"exempt\") {\n    const taxableAmount = discountedSubtotal + shipping;\n    taxAmount = taxableAmount * (taxRate / 100);\n  }\n\n  // Calculate total\n  let total = discountedSubtotal + shipping;\n  if (taxType === \"excluded\") {\n    total += taxAmount;\n  }\n\n  return {\n    subtotal,\n    discountTotal,\n    discountedSubtotal,\n    shipping,\n    taxType,\n    taxRate,\n    taxAmount,\n    total,\n    currency,\n  };\n}\n\n/**\n * Create initial quote\n */\nfunction createInitialQuote(\n  options: UseQuoteBuilderOptions,\n  generateQuoteNumber: () => string\n): Quote {\n  const now = new Date();\n  const validityDays = options.validityDays ?? 30;\n  const expirationDate = new Date(now);\n  expirationDate.setDate(expirationDate.getDate() + validityDays);\n\n  const initialQuote: Quote = {\n    id: options.initialQuote?.id ?? generateId(),\n    quoteNumber: options.initialQuote?.quoteNumber ?? generateQuoteNumber(),\n    status: options.initialQuote?.status ?? \"draft\",\n    customer: options.customer,\n    items: options.initialQuote?.items ?? [],\n    discounts: options.initialQuote?.discounts ?? [],\n    pricing: options.initialQuote?.pricing ?? {\n      subtotal: 0,\n      discountTotal: 0,\n      discountedSubtotal: 0,\n      shipping: 0,\n      taxType: options.taxType ?? \"excluded\",\n      taxRate: options.taxRate ?? 20,\n      taxAmount: 0,\n      total: 0,\n      currency: options.currency ?? \"EUR\",\n    },\n    terms: options.initialQuote?.terms ?? {\n      paymentTerms: options.paymentTerms ?? \"NET30\",\n      validityDays,\n      expirationDate,\n    },\n    createdBy: options.initialQuote?.createdBy ?? {\n      id: \"\",\n      name: \"\",\n      email: \"\",\n    },\n    createdAt: options.initialQuote?.createdAt ?? now,\n    updatedAt: now,\n    version: options.initialQuote?.version ?? 1,\n  };\n\n  // Add optional metadata only if present\n  if (options.initialQuote?.metadata) {\n    initialQuote.metadata = options.initialQuote.metadata;\n  }\n\n  return initialQuote;\n}\n\n/**\n * Validate quote\n */\nfunction validateQuote(quote: Quote): QuoteValidationError[] {\n  const errors: QuoteValidationError[] = [];\n\n  // Validate items\n  if (quote.items.length === 0) {\n    errors.push({\n      field: \"items\",\n      message: \"Quote must have at least one item\",\n      type: \"error\",\n    });\n  }\n\n  // Validate quantities\n  quote.items.forEach((item, index) => {\n    if (item.quantity <= 0) {\n      errors.push({\n        field: `items[${index}].quantity`,\n        message: `Item \"${item.name}\" must have a positive quantity`,\n        type: \"error\",\n      });\n    }\n    if (item.unitPrice < 0) {\n      errors.push({\n        field: `items[${index}].unitPrice`,\n        message: `Item \"${item.name}\" cannot have a negative price`,\n        type: \"error\",\n      });\n    }\n  });\n\n  // Validate customer\n  if (!quote.customer.companyName) {\n    errors.push({\n      field: \"customer.companyName\",\n      message: \"Company name is required\",\n      type: \"error\",\n    });\n  }\n  if (!quote.customer.email) {\n    errors.push({\n      field: \"customer.email\",\n      message: \"Customer email is required\",\n      type: \"error\",\n    });\n  }\n\n  // Validate expiration\n  if (quote.terms.expirationDate < new Date()) {\n    errors.push({\n      field: \"terms.expirationDate\",\n      message: \"Quote expiration date is in the past\",\n      type: \"warning\",\n    });\n  }\n\n  return errors;\n}\n\n/**\n * Hook for quote building functionality\n *\n * Provides comprehensive quote construction from cart items\n * with support for discounts, taxes, and custom terms.\n *\n * @example\n * ```tsx\n * const {\n *   state,\n *   addItem,\n *   importFromCart,\n *   setShipping,\n *   save,\n *   send,\n * } = useQuoteBuilder({\n *   customer: selectedCustomer,\n *   currency: 'EUR',\n *   taxRate: 20,\n *   validityDays: 30,\n *   onSend: async (quote) => {\n *     await emailQuoteToCustomer(quote);\n *   },\n * });\n *\n * // Import from cart\n * importFromCart(cartItems);\n *\n * // Apply bulk discount\n * addDiscount({ type: 'percentage', value: 10, reason: 'Volume discount' });\n *\n * // Display quote\n * <QuotePreview\n *   items={state.quote.items}\n *   pricing={state.quote.pricing}\n *   onSend={send}\n * />\n * ```\n */\nexport function useQuoteBuilder(\n  options: UseQuoteBuilderOptions\n): UseQuoteBuilderReturn {\n  const {\n    customer,\n    currency = \"EUR\",\n    taxRate = 20,\n    taxType = \"excluded\",\n    autoCalculate = true,\n    generateQuoteNumber = defaultGenerateQuoteNumber,\n    onChange,\n    onSave,\n    onSend,\n  } = options;\n\n  const [quote, setQuote] = useState<Quote>(() =>\n    createInitialQuote(options, generateQuoteNumber)\n  );\n  const [isDirty, setIsDirty] = useState(false);\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set());\n\n  // Recalculate pricing\n  const recalculatePricing = useCallback(\n    (currentQuote: Quote): Quote => {\n      const pricing = calculatePricing(\n        currentQuote.items,\n        currentQuote.discounts,\n        currentQuote.pricing.shipping,\n        currentQuote.pricing.taxRate,\n        currentQuote.pricing.taxType,\n        currentQuote.pricing.currency\n      );\n\n      return {\n        ...currentQuote,\n        pricing,\n        updatedAt: new Date(),\n      };\n    },\n    []\n  );\n\n  // Update quote with optional recalculation\n  const updateQuote = useCallback(\n    (updater: (prev: Quote) => Quote) => {\n      setQuote((prev) => {\n        let updated = updater(prev);\n\n        if (autoCalculate) {\n          updated = recalculatePricing(updated);\n        }\n\n        setIsDirty(true);\n        onChange?.(updated);\n\n        return updated;\n      });\n    },\n    [autoCalculate, recalculatePricing, onChange]\n  );\n\n  // Calculate line item totals\n  const calculateItemTotals = useCallback(\n    (item: Partial<QuoteLineItem>): QuoteLineItem => {\n      const unitPrice = item.unitPrice ?? 0;\n      const quantity = item.quantity ?? 1;\n      const effectiveUnitPrice = calculateEffectiveUnitPrice(\n        unitPrice,\n        item.discount\n      );\n      const { lineTotal, taxAmount: calculatedTaxAmount } = calculateLineTotal(\n        effectiveUnitPrice,\n        quantity,\n        item.taxRate ?? taxRate,\n        taxType === \"included\"\n      );\n\n      // Build result with only defined optional properties\n      const result: QuoteLineItem = {\n        id: item.id ?? generateId(),\n        productId: item.productId ?? \"\",\n        name: item.name ?? \"\",\n        quantity,\n        unitPrice,\n        effectiveUnitPrice,\n        lineTotal,\n      };\n\n      // Conditionally add optional properties\n      if (item.description !== undefined) result.description = item.description;\n      if (item.sku !== undefined) result.sku = item.sku;\n      if (item.unit !== undefined) result.unit = item.unit;\n      if (item.discount !== undefined) result.discount = item.discount;\n      result.taxRate = item.taxRate ?? taxRate;\n      result.taxAmount = calculatedTaxAmount;\n      if (item.customizable !== undefined) result.customizable = item.customizable;\n      if (item.customOptions !== undefined) result.customOptions = item.customOptions;\n      if (item.leadTime !== undefined) result.leadTime = item.leadTime;\n      if (item.notes !== undefined) result.notes = item.notes;\n      if (item.cartItemId !== undefined) result.cartItemId = item.cartItemId;\n\n      return result;\n    },\n    [taxRate, taxType]\n  );\n\n  // Validation\n  const errors = useMemo(() => validateQuote(quote), [quote]);\n  const isValid = errors.filter((e) => e.type === \"error\").length === 0;\n\n  // State\n  const state: QuoteBuilderState = useMemo(\n    () => ({\n      quote,\n      isDirty,\n      errors,\n      isValid,\n      selectedItems,\n    }),\n    [quote, isDirty, errors, isValid, selectedItems]\n  );\n\n  // Line item actions\n  const addItem = useCallback(\n    (item: Omit<QuoteLineItem, \"id\" | \"effectiveUnitPrice\" | \"lineTotal\">) => {\n      const newItem = calculateItemTotals(item);\n      updateQuote((prev) => ({\n        ...prev,\n        items: [...prev.items, newItem],\n      }));\n    },\n    [calculateItemTotals, updateQuote]\n  );\n\n  const updateItem = useCallback(\n    (itemId: string, updates: Partial<QuoteLineItem>) => {\n      updateQuote((prev) => ({\n        ...prev,\n        items: prev.items.map((item) =>\n          item.id === itemId\n            ? calculateItemTotals({ ...item, ...updates })\n            : item\n        ),\n      }));\n    },\n    [calculateItemTotals, updateQuote]\n  );\n\n  const removeItem = useCallback(\n    (itemId: string) => {\n      updateQuote((prev) => ({\n        ...prev,\n        items: prev.items.filter((item) => item.id !== itemId),\n      }));\n      setSelectedItems((prev) => {\n        const newSet = new Set(prev);\n        newSet.delete(itemId);\n        return newSet;\n      });\n    },\n    [updateQuote]\n  );\n\n  const duplicateItem = useCallback(\n    (itemId: string) => {\n      const item = quote.items.find((i) => i.id === itemId);\n      if (item) {\n        const newItem = calculateItemTotals({\n          ...item,\n          id: generateId(),\n          notes: `Copy of: ${item.name}`,\n        });\n        updateQuote((prev) => {\n          const index = prev.items.findIndex((i) => i.id === itemId);\n          const newItems = [...prev.items];\n          newItems.splice(index + 1, 0, newItem);\n          return { ...prev, items: newItems };\n        });\n      }\n    },\n    [quote.items, calculateItemTotals, updateQuote]\n  );\n\n  const setItemQuantity = useCallback(\n    (itemId: string, quantity: number) => {\n      updateItem(itemId, { quantity: Math.max(1, quantity) });\n    },\n    [updateItem]\n  );\n\n  const applyItemDiscount = useCallback(\n    (itemId: string, discount: QuoteLineItem[\"discount\"]) => {\n      if (discount) {\n        updateItem(itemId, { discount });\n      }\n    },\n    [updateItem]\n  );\n\n  const clearItemDiscount = useCallback(\n    (itemId: string) => {\n      // To clear discount, we need to update the item without the discount property\n      updateQuote((prev) => ({\n        ...prev,\n        items: prev.items.map((item) => {\n          if (item.id !== itemId) return item;\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          const { discount: _, ...itemWithoutDiscount } = item;\n          return calculateItemTotals(itemWithoutDiscount);\n        }),\n      }));\n    },\n    [updateQuote, calculateItemTotals]\n  );\n\n  const reorderItems = useCallback(\n    (fromIndex: number, toIndex: number) => {\n      updateQuote((prev) => {\n        // Validate indices\n        if (fromIndex < 0 || fromIndex >= prev.items.length) return prev;\n        if (toIndex < 0 || toIndex > prev.items.length) return prev;\n\n        const newItems = [...prev.items];\n        // splice returns array, destructure to get first element\n        const [removed] = newItems.splice(fromIndex, 1);\n        // TypeScript control flow analysis with destructuring\n        if (removed === undefined) return prev;\n        newItems.splice(toIndex, 0, removed);\n        return { ...prev, items: newItems };\n      });\n    },\n    [updateQuote]\n  );\n\n  // Helper to convert cart item to partial line item\n  const cartItemToPartial = useCallback(\n    (cartItem: CartItem): Partial<QuoteLineItem> => {\n      const partial: Partial<QuoteLineItem> = {\n        productId: cartItem.productId,\n        name: cartItem.name,\n        quantity: cartItem.quantity,\n        unitPrice: cartItem.unitPrice,\n        cartItemId: cartItem.id,\n      };\n      if (cartItem.description) partial.description = cartItem.description;\n      if (cartItem.sku) partial.sku = cartItem.sku;\n      if (cartItem.customOptions) partial.customOptions = cartItem.customOptions;\n      return partial;\n    },\n    []\n  );\n\n  // Cart conversion\n  const importFromCart = useCallback(\n    (cartItems: CartItem[]) => {\n      const newItems = cartItems.map((cartItem) =>\n        calculateItemTotals(cartItemToPartial(cartItem))\n      );\n\n      updateQuote((prev) => ({\n        ...prev,\n        items: [...prev.items, ...newItems],\n      }));\n    },\n    [calculateItemTotals, cartItemToPartial, updateQuote]\n  );\n\n  const replaceFromCart = useCallback(\n    (cartItems: CartItem[]) => {\n      const newItems = cartItems.map((cartItem) =>\n        calculateItemTotals(cartItemToPartial(cartItem))\n      );\n\n      updateQuote((prev) => ({\n        ...prev,\n        items: newItems,\n      }));\n      setSelectedItems(new Set());\n    },\n    [calculateItemTotals, updateQuote]\n  );\n\n  // Quote-level discount actions\n  const addDiscount = useCallback(\n    (discount: Omit<QuoteDiscount, \"id\">) => {\n      const newDiscount: QuoteDiscount = {\n        ...discount,\n        id: generateId(),\n      };\n      updateQuote((prev) => ({\n        ...prev,\n        discounts: [...prev.discounts, newDiscount],\n      }));\n    },\n    [updateQuote]\n  );\n\n  const removeDiscount = useCallback(\n    (discountId: string) => {\n      updateQuote((prev) => ({\n        ...prev,\n        discounts: prev.discounts.filter((d) => d.id !== discountId),\n      }));\n    },\n    [updateQuote]\n  );\n\n  const clearDiscounts = useCallback(() => {\n    updateQuote((prev) => ({\n      ...prev,\n      discounts: [],\n    }));\n  }, [updateQuote]);\n\n  // Pricing actions\n  const setShipping = useCallback(\n    (amount: number) => {\n      updateQuote((prev) => ({\n        ...prev,\n        pricing: { ...prev.pricing, shipping: Math.max(0, amount) },\n      }));\n    },\n    [updateQuote]\n  );\n\n  const setTaxRate = useCallback(\n    (rate: number) => {\n      updateQuote((prev) => ({\n        ...prev,\n        pricing: { ...prev.pricing, taxRate: Math.max(0, rate) },\n      }));\n    },\n    [updateQuote]\n  );\n\n  const setTaxType = useCallback(\n    (type: TaxType) => {\n      updateQuote((prev) => ({\n        ...prev,\n        pricing: { ...prev.pricing, taxType: type },\n      }));\n    },\n    [updateQuote]\n  );\n\n  const recalculate = useCallback(() => {\n    setQuote((prev) => recalculatePricing(prev));\n  }, [recalculatePricing]);\n\n  // Terms actions\n  const updateTerms = useCallback(\n    (terms: Partial<QuoteTerms>) => {\n      updateQuote((prev) => ({\n        ...prev,\n        terms: { ...prev.terms, ...terms },\n      }));\n    },\n    [updateQuote]\n  );\n\n  const setExpirationDate = useCallback(\n    (date: Date) => {\n      updateTerms({ expirationDate: date });\n    },\n    [updateTerms]\n  );\n\n  const setValidityDays = useCallback(\n    (days: number) => {\n      const expirationDate = new Date();\n      expirationDate.setDate(expirationDate.getDate() + days);\n      updateTerms({ validityDays: days, expirationDate });\n    },\n    [updateTerms]\n  );\n\n  // Customer actions\n  const updateCustomer = useCallback(\n    (customerUpdates: Partial<QuoteCustomer>) => {\n      updateQuote((prev) => ({\n        ...prev,\n        customer: { ...prev.customer, ...customerUpdates },\n      }));\n    },\n    [updateQuote]\n  );\n\n  // Selection actions\n  const selectItem = useCallback((itemId: string) => {\n    setSelectedItems((prev) => new Set(prev).add(itemId));\n  }, []);\n\n  const deselectItem = useCallback((itemId: string) => {\n    setSelectedItems((prev) => {\n      const newSet = new Set(prev);\n      newSet.delete(itemId);\n      return newSet;\n    });\n  }, []);\n\n  const toggleItemSelection = useCallback((itemId: string) => {\n    setSelectedItems((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(itemId)) {\n        newSet.delete(itemId);\n      } else {\n        newSet.add(itemId);\n      }\n      return newSet;\n    });\n  }, []);\n\n  const selectAllItems = useCallback(() => {\n    setSelectedItems(new Set(quote.items.map((item) => item.id)));\n  }, [quote.items]);\n\n  const deselectAllItems = useCallback(() => {\n    setSelectedItems(new Set());\n  }, []);\n\n  const removeSelectedItems = useCallback(() => {\n    updateQuote((prev) => ({\n      ...prev,\n      items: prev.items.filter((item) => !selectedItems.has(item.id)),\n    }));\n    setSelectedItems(new Set());\n  }, [selectedItems, updateQuote]);\n\n  const applyDiscountToSelected = useCallback(\n    (discount: QuoteLineItem[\"discount\"]) => {\n      if (!discount) return;\n      updateQuote((prev) => ({\n        ...prev,\n        items: prev.items.map((item) =>\n          selectedItems.has(item.id)\n            ? calculateItemTotals({ ...item, discount })\n            : item\n        ),\n      }));\n    },\n    [selectedItems, calculateItemTotals, updateQuote]\n  );\n\n  // Quote actions\n  const save = useCallback((): Quote => {\n    const savedQuote = recalculatePricing(quote);\n    setQuote(savedQuote);\n    setIsDirty(false);\n    onSave?.(savedQuote);\n    return savedQuote;\n  }, [quote, recalculatePricing, onSave]);\n\n  const send = useCallback(() => {\n    const sentQuote: Quote = {\n      ...recalculatePricing(quote),\n      status: \"sent\",\n      sentAt: new Date(),\n    };\n    setQuote(sentQuote);\n    setIsDirty(false);\n    onSend?.(sentQuote);\n  }, [quote, recalculatePricing, onSend]);\n\n  const createRevision = useCallback(() => {\n    // Create revision without the date properties (they will be omitted)\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { sentAt, viewedAt, respondedAt, ...baseQuote } = quote;\n    const revision: Quote = {\n      ...baseQuote,\n      id: generateId(),\n      quoteNumber: generateQuoteNumber(),\n      status: \"draft\",\n      version: quote.version + 1,\n      originalQuoteId: quote.id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    setQuote(revision);\n    setIsDirty(true);\n  }, [quote, generateQuoteNumber]);\n\n  const reset = useCallback(() => {\n    setQuote(createInitialQuote(options, generateQuoteNumber));\n    setIsDirty(false);\n    setSelectedItems(new Set());\n  }, [options, generateQuoteNumber]);\n\n  const markDirty = useCallback(() => {\n    setIsDirty(true);\n  }, []);\n\n  const markClean = useCallback(() => {\n    setIsDirty(false);\n  }, []);\n\n  // Validation\n  const validate = useCallback(() => validateQuote(quote), [quote]);\n\n  const getItem = useCallback(\n    (itemId: string) => quote.items.find((item) => item.id === itemId),\n    [quote.items]\n  );\n\n  const hasItem = useCallback(\n    (itemId: string) => quote.items.some((item) => item.id === itemId),\n    [quote.items]\n  );\n\n  return {\n    state,\n\n    // Line item actions\n    addItem,\n    updateItem,\n    removeItem,\n    duplicateItem,\n    setItemQuantity,\n    applyItemDiscount,\n    clearItemDiscount,\n    reorderItems,\n\n    // Cart conversion\n    importFromCart,\n    replaceFromCart,\n\n    // Quote-level discount actions\n    addDiscount,\n    removeDiscount,\n    clearDiscounts,\n\n    // Pricing actions\n    setShipping,\n    setTaxRate,\n    setTaxType,\n    recalculate,\n\n    // Terms actions\n    updateTerms,\n    setExpirationDate,\n    setValidityDays,\n\n    // Customer actions\n    updateCustomer,\n\n    // Selection actions\n    selectItem,\n    deselectItem,\n    toggleItemSelection,\n    selectAllItems,\n    deselectAllItems,\n    removeSelectedItems,\n    applyDiscountToSelected,\n\n    // Quote actions\n    save,\n    send,\n    createRevision,\n    reset,\n    markDirty,\n    markClean,\n\n    // Validation\n    validate,\n    getItem,\n    hasItem,\n  };\n}\n"],"mappings":"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","names":["useCallback","useMemo","useCallback","useMemo","useState","useCallback","useMemo","useState","useState","useMemo","useCallback","useCallback","useMemo","useState"]}